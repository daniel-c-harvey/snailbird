@using Core;
@using Core.Converters;
@using RazorCore;

@page "/tabletest"

@rendermode InteractiveServer
@* @attribute [StreamRendering] *@

<PageTitle>Table Test</PageTitle>

<div>
    <NewRowTable TModel="Cash" models="@coins" columnMap="@coinMap"/>
</div>

@code{
    private class Cash
    {
        public int Dubloons { get; set; }
        public int Bones { get; set; }
        public int Clams { get; set; }
    }
    private IEnumerable<Cash> coins = new[] { new Cash { Dubloons = 1, Bones = 2 }, 
                                              new Cash { Dubloons = 3, Bones = 4 } };
    private IColumnMap<Counted<Cash>> coinMap = new ColumnMap<Counted<Cash>>();

    protected override void OnInitialized()
    {
        base.OnInitialized();
        
        coinMap
            .AddColumn($"{nameof(Cash.Dubloons)} Caption", 
                new ModelColumn<Counted<Cash>>(
                    m => IntConverter.ToString(m.Entity.Dubloons), 
                    (m, s) => m.Entity.Dubloons = IntConverter.FromString(s)))
            .AddColumn($"My Fancy {nameof(Cash.Bones)} Caption",
                new ModelColumn<Counted<Cash>>(
                    m => IntConverter.ToString(m.Entity.Bones), 
                    (m, s) => m.Entity.Bones = IntConverter.FromString(s)))
            .AddColumn($"Editable {nameof(Cash.Clams)} Caption", 
                new ModelColumn<Counted<Cash>>(
                    m => IntConverter.ToString(m.Entity.Clams), 
                    (m, s) => m.Entity.Clams = IntConverter.FromString(s), 
                    editable: true));

    }
}